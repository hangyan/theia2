- builder:
    name: builder-e2e
    builders:
      - shell: |-
          #!/usr/bin/env bash
          set -ex
          DOKCER_REGISTRY="$(head -n1 ci/docker-registry)"
          chmod a+x ci/jenkins/test-vmc.sh
          chmod a+x ci/jenkins/test-flow-visibility.sh
          ./ci/jenkins/test-vmc.sh --cluster-name "$BUILD_TAG" --registry  "${DOCKER_REGISTRY}" --username "${CAPVC_USERNAME}" --password "${CAPVC_PASSWORD}" --setup-only
          ./ci/jenkins/test-flow-visibility.sh --kubeconfig jenkins/out/kubeconfig
          ./ci/jenkins/test-vmc.sh --cluster-name "$BUILD_TAG" --registry "${DOCKER_REGISTRY}" --username "${CAPVC_USERNAME}" --password "${CAPVC_PASSWORD}" --cleanup-only

          if !(test -f TEST_FAILURE); then
            echo "=== SUCCESS !!! ==="
            exit 0
          fi
          echo "=== FAILURE !!! ==="
          exit 1
